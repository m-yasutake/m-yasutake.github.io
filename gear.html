<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Tomika Bike â€“ Gear list and packing checklist for our cycling adventure." />
  <title>Gear â€“ Tomika Bike</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš´</text></svg>" />

  <style>
    .gear-grid {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 2rem;
      align-items: start;
    }
    @media (max-width: 900px) { .gear-grid { grid-template-columns: 1fr; } }

    .gear-category {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-gray-200);
      box-shadow: var(--shadow-sm);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .gear-category-header {
      background: linear-gradient(135deg, var(--color-primary), #2a7a6e);
      color: var(--color-white);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .gear-category-header h3 { margin: 0; font-size: 1.1rem; }
    .gear-category-icon { font-size: 1.4rem; }

    .gear-table {
      width: 100%;
      border-collapse: collapse;
    }

    .gear-table th {
      background: var(--color-gray-100);
      color: var(--color-primary);
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.6rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--color-gray-200);
    }

    .gear-table td {
      padding: 0.7rem 1rem;
      font-size: 0.9rem;
      border-bottom: 1px solid var(--color-gray-100);
      vertical-align: middle;
    }

    .gear-table tr:last-child td { border-bottom: none; }
    .gear-table tr:hover td { background: rgba(42,157,143,0.04); }

    .gear-weight {
      color: var(--color-gray-600);
      font-size: 0.82rem;
      white-space: nowrap;
    }

    .gear-notes {
      color: var(--color-gray-600);
      font-size: 0.82rem;
      font-style: italic;
    }

    .gear-tag {
      display: inline-block;
      padding: 0.15rem 0.6rem;
      border-radius: var(--radius-full);
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .gear-tag.mika { background: rgba(230,126,179,0.15); color: #b03a7a; }
    .gear-tag.tom  { background: rgba(66,133,244,0.15);  color: #1a56a3; }
    .gear-tag.both { background: rgba(42,157,143,0.12);  color: #1a7a6e; }

    /* Packing checklist */
    .pack-list { list-style: none; padding: 0; }
    .pack-list li {
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .6rem 0;
      border-bottom: 1px solid var(--color-gray-100);
      font-size: .9rem;
    }
    .pack-list li:last-child { border-bottom: none; }

    .pack-check {
      width: 20px; height: 20px;
      border-radius: 4px;
      border: 2px solid var(--color-gray-300);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }
    .pack-check.checked { background: var(--color-secondary); border-color: var(--color-secondary); color: var(--color-white); }

    .pack-progress-bar {
      height: 6px;
      background: var(--color-gray-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-top: 0.75rem;
    }
    .pack-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-secondary), var(--color-accent));
      border-radius: var(--radius-full);
      transition: width 0.4s ease;
    }

    .weight-summary {
      background: linear-gradient(135deg, var(--color-primary), #2a7a6e);
      border-radius: var(--radius-lg);
      padding: 1.25rem 1.5rem;
      color: var(--color-white);
      margin-bottom: 1.5rem;
    }
    .weight-summary h4 { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.06em; opacity: 0.8; margin-bottom: 0.5rem; }
    .weight-big { font-size: 2.5rem; font-weight: 700; font-family: var(--font-heading); }
    .weight-sub { font-size: 0.85rem; opacity: 0.75; }

    /* â”€â”€ Admin editing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gear-admin-bar {
      display: none;
      align-items: center;
      gap: 0.75rem;
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: var(--radius-md);
      padding: 0.65rem 1rem;
      margin-bottom: 1.25rem;
      font-size: 0.9rem;
      color: #6d4c00;
    }
    .gear-admin-bar strong { flex: 1; }
    .gear-admin-btn {
      padding: 0.4rem 1rem;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: opacity 0.15s;
    }
    .gear-admin-btn:hover { opacity: 0.85; }
    .gear-admin-btn.edit  { background: var(--color-primary); color: #fff; }
    .gear-admin-btn.save  { background: #1a7a1a; color: #fff; }
    .gear-admin-btn.cancel{ background: var(--color-gray-300); color: var(--color-gray-800); }

    /* Edit-mode cell styles */
    .gear-category[data-editing] td[contenteditable] {
      background: #f0faf9;
      outline: 1px dashed var(--color-primary);
      border-radius: 3px;
      min-width: 4rem;
      cursor: text;
    }
    .gear-category[data-editing] td[contenteditable]:focus {
      outline: 2px solid var(--color-primary);
      background: #fff;
    }
    .gear-category[data-editing] .gear-category-header h3[contenteditable],
    .gear-category[data-editing] .gear-category-header span[contenteditable] {
      outline: 1px dashed rgba(255,255,255,0.7);
      border-radius: 3px;
      padding: 0 3px;
      cursor: text;
    }
    .gear-status-select {
      border: 1px solid var(--color-gray-300);
      border-radius: var(--radius-sm);
      padding: 0.2rem 0.4rem;
      font-size: 0.8rem;
      background: #fff;
      cursor: pointer;
    }
    .gear-row-delete {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      opacity: 0.5;
      padding: 0.2rem;
      transition: opacity 0.15s;
    }
    .gear-row-delete:hover { opacity: 1; }
    .gear-cat-delete {
      margin-left: auto;
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.4);
      color: #fff;
      border-radius: var(--radius-sm);
      cursor: pointer;
      padding: 0.15rem 0.5rem;
      font-size: 0.85rem;
      transition: background 0.15s;
    }
    .gear-cat-delete:hover { background: rgba(255,0,0,0.3); }
    .gear-add-row-btn, .gear-add-cat-btn {
      background: none;
      border: 1px dashed var(--color-primary);
      color: var(--color-primary);
      border-radius: var(--radius-sm);
      padding: 0.35rem 1rem;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      width: 100%;
      transition: background 0.15s;
    }
    .gear-add-row-btn:hover, .gear-add-cat-btn:hover { background: rgba(42,157,143,0.07); }
    .gear-add-cat-btn { margin-top: 0.75rem; }

    /* â”€â”€ Bike Setup Photos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bike-setups {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    @media (max-width: 600px) { .bike-setups { grid-template-columns: 1fr; } }
    .bike-setup-card {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-gray-200);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      text-align: center;
    }
    .bike-setup-img {
      width: 100%;
      aspect-ratio: 4/3;
      background: linear-gradient(135deg, var(--color-gray-100), var(--color-gray-200));
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
      color: var(--color-gray-500);
    }
    .bike-setup-img .placeholder-icon { font-size: 4rem; }
    .bike-setup-img .placeholder-text { font-size: 0.85rem; font-style: italic; }
    .bike-setup-label {
      padding: 0.75rem 1rem;
      font-weight: 600;
      font-size: 1rem;
      color: var(--color-primary);
      font-family: var(--font-heading);
    }

    /* â”€â”€ Split weight summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .weight-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }
    .weight-person-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0.8;
      margin-bottom: 0.15rem;
    }
  </style>
</head>
<body>

<!-- Page Loader -->
<div class="page-loader">
  <div class="loader-inner">
    <div class="loader-logo">tomika<span class="accent">.bike</span></div>
    <div class="loader-dots"><div class="loader-dot"></div><div class="loader-dot"></div><div class="loader-dot"></div></div>
  </div>
</div>

<!-- Navigation -->
<nav class="navbar">
  <div class="nav-inner">
    <a href="index.html" class="nav-logo"><span class="logo-icon">ğŸš´</span><span>tomika<span class="accent">.bike</span></span></a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="planning.html">Map</a></li>
      <li><a href="blog.html">Blog</a></li>
      <li><a href="photos.html">Photos</a></li>
      <li><a href="journal.html">Journal</a></li>
      <li><a href="gear.html">Gear</a></li>
      <li class="admin-only-link" style="display:none"><a href="admin.html">Admin</a></li>
    </ul>
    <div class="nav-actions">
      <button class="nav-login-btn" data-auth>
        <svg viewBox="0 0 24 24" fill="none" width="16" height="16"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        Sign In
      </button>
    </div>
    <button class="hamburger" aria-label="Toggle menu"><span></span><span></span><span></span></button>
  </div>
</nav>

<div class="mobile-menu">
  <a href="index.html">ğŸ  Home</a>
  <a href="planning.html">ğŸ—ºï¸ Map</a>
  <a href="blog.html">âœï¸ Blog</a>
  <a href="photos.html">ğŸ“· Photos</a>
  <a href="journal.html">ğŸ“” Journal</a>
  <a href="gear.html">ğŸ’ Gear</a>
  <a href="admin.html" class="admin-only-link" style="display:none">âš™ï¸ Admin</a>
  <button class="btn btn-primary" style="margin-top:.5rem" data-auth>Sign In with Google</button>
</div>

<div class="auth-overlay">
  <div class="auth-modal">
    <button class="auth-close">âœ•</button>
    <h2>Welcome back ğŸ‘‹</h2>
    <p>Sign in to access your journal and admin tools</p>
    <button class="google-btn">
      <svg viewBox="0 0 24 24" fill="none" width="20" height="20"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      Continue with Google
    </button>
    <p class="auth-note">Firebase auth coming soon</p>
  </div>
</div>

<!-- Page Hero -->
<div class="page-hero">
  <div class="container">
    <div class="hero-badge" style="margin-bottom:.75rem">ğŸ’ Gear &amp; Packing</div>
    <h1>Gear List</h1>
    <p>Everything we're bringing on the road â€“ gear list, specs, and the essential packing checklist.</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GEAR CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="section" style="padding-top:2rem">
  <div class="container">
    <div class="gear-grid">

      <!-- Left: Gear Tables (rendered by JS) -->
      <div>

        <!-- Bike Setup Photos -->
        <div class="bike-setups">
          <div class="bike-setup-card">
            <div class="bike-setup-img">
              <span class="placeholder-icon" role="img" aria-label="Bicycle">ğŸš²</span>
              <span class="placeholder-text">Photo coming soon</span>
            </div>
            <div class="bike-setup-label">Mika's Bike</div>
          </div>
          <div class="bike-setup-card">
            <div class="bike-setup-img">
              <span class="placeholder-icon" role="img" aria-label="Bicycle">ğŸš²</span>
              <span class="placeholder-text">Photo coming soon</span>
            </div>
            <div class="bike-setup-label">Tom's Bike</div>
          </div>
        </div>

        <!-- Admin editing toolbar (only visible when signed in as admin) -->
        <div class="gear-admin-bar" id="gearAdminBar">
          <strong>âœï¸ Admin: you can edit this gear list</strong>
          <button class="gear-admin-btn edit" id="gearEditBtn">âœï¸ Edit Gear</button>
          <button class="gear-admin-btn save" id="gearSaveBtn" style="display:none">ğŸ’¾ Save</button>
          <button class="gear-admin-btn cancel" id="gearCancelBtn" style="display:none">âœ• Cancel</button>
        </div>

        <!-- Gear tables injected here by GearManager.init() -->
        <div id="gearContent">
          <p style="padding:2rem;color:var(--color-gray-600)">Loading gear listâ€¦</p>
        </div>

      </div>

      <!-- Right: Sidebar -->
      <div>

        <!-- Weight Summary -->
        <div class="weight-summary">
          <h4>Estimated Pack Weight</h4>
          <div class="weight-split">
            <div>
              <div class="weight-person-label">Mika</div>
              <div class="weight-big" id="weightMika">â€”</div>
              <div class="weight-sub">kg (loaded)</div>
            </div>
            <div>
              <div class="weight-person-label">Tom</div>
              <div class="weight-big" id="weightTom">â€”</div>
              <div class="weight-sub">kg (loaded)</div>
            </div>
          </div>
          <div class="weight-sub" style="margin-top:0.5rem">Target: &lt;25 kg per bike</div>
        </div>

        <!-- Packing Checklist -->
        <div class="sidebar-widget">
          <h3>Packing Checklist</h3>
          <ul class="pack-list" id="packList">
            <li><div class="pack-check checked" onclick="toggleCheck(this)">âœ“</div> Touring bike + panniers</li>
            <li><div class="pack-check checked" onclick="toggleCheck(this)">âœ“</div> Tent + sleeping bag</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Repair kit &amp; spare tubes</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Waterproof panniers</li>
            <li><div class="pack-check checked" onclick="toggleCheck(this)">âœ“</div> GPS device</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> First aid kit</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Solar charging panel</li>
            <li><div class="pack-check checked" onclick="toggleCheck(this)">âœ“</div> Camera + lenses</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Travel insurance</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Visas sorted</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Spare tubes (Ã—4)</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Chain lube</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> High-vis vests</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Power banks charged</li>
            <li><div class="pack-check" onclick="toggleCheck(this)"></div> Offline maps downloaded</li>
          </ul>
          <div class="pack-progress-bar"><div class="pack-progress-fill" id="packProgressFill" style="width:0%"></div></div>
          <div style="margin-top:.5rem;font-size:.8rem;color:var(--color-gray-600)" id="packProgress"></div>
        </div>

        <!-- Quick Stats -->
        <div class="sidebar-widget" style="margin-top:1.5rem">
          <h3>By the Numbers</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
            <div style="text-align:center;background:var(--color-gray-100);border-radius:var(--radius-md);padding:1rem">
              <div style="font-size:1.75rem;font-weight:700;color:var(--color-secondary);font-family:var(--font-heading)">~22</div>
              <div style="font-size:.8rem;color:var(--color-gray-600)">kg per bike</div>
            </div>
            <div style="text-align:center;background:var(--color-gray-100);border-radius:var(--radius-md);padding:1rem">
              <div style="font-size:1.75rem;font-weight:700;color:var(--color-accent);font-family:var(--font-heading)">40+</div>
              <div style="font-size:.8rem;color:var(--color-gray-600)">items each</div>
            </div>
            <div style="text-align:center;background:var(--color-gray-100);border-radius:var(--radius-md);padding:1rem">
              <div style="font-size:1.75rem;font-weight:700;color:var(--color-secondary);font-family:var(--font-heading)">4</div>
              <div style="font-size:.8rem;color:var(--color-gray-600)">panniers</div>
            </div>
            <div style="text-align:center;background:var(--color-gray-100);border-radius:var(--radius-md);padding:1rem">
              <div style="font-size:1.75rem;font-weight:700;color:var(--color-warm);font-family:var(--font-heading)">180</div>
              <div style="font-size:.8rem;color:var(--color-gray-600)">days on road</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer>
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <div class="footer-logo">ğŸš´ tomika<span class="accent">.bike</span></div>
        <p>A cycling adventure blog documenting our journey across continents. Planning routes, collecting stories, and sharing every beautiful moment.</p>
        <div class="social-links">
          <a class="social-link" title="Instagram" aria-label="Instagram">ğŸ“¸</a>
          <a class="social-link" title="Twitter" aria-label="Twitter">ğŸ¦</a>
          <a class="social-link" title="YouTube" aria-label="YouTube">â–¶ï¸</a>
          <a class="social-link" title="Strava" aria-label="Strava">ğŸƒ</a>
        </div>
      </div>
      <div class="footer-col">
        <h4>Explore</h4>
        <a href="index.html">Home</a>
        <a href="planning.html">Map</a>
        <a href="blog.html">Blog</a>
        <a href="photos.html">Photos</a>
        <a href="gear.html">Gear</a>
      </div>
      <div class="footer-col">
        <h4>Account</h4>
        <a href="journal.html">Private Journal</a>
        <a href="#" data-auth>Sign In</a>
      </div>
      <div class="footer-col">
        <h4>Info</h4>
        <a href="#">About Us</a>
        <a href="#">Contact</a>
        <a href="#">Privacy Policy</a>
        <a href="#">tomika.bike</a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>Â© 2026 tomika.bike â€“ All rights reserved</span>
      <span>Made with â¤ï¸ and ğŸš´ by Tomika &amp; Partner</span>
    </div>
  </div>
</footer>

<script src="js/main.js"></script>
<script>
// â”€â”€ Packing checklist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleCheck(el) {
  el.classList.toggle('checked');
  el.textContent = el.classList.contains('checked') ? 'âœ“' : '';
  updatePackProgress();
}

function updatePackProgress() {
  const items = document.querySelectorAll('.pack-check');
  const checked = document.querySelectorAll('.pack-check.checked').length;
  const total = items.length;
  const pct = total > 0 ? Math.round((checked / total) * 100) : 0;
  const prog = document.getElementById('packProgress');
  const fill = document.getElementById('packProgressFill');
  if (prog) prog.textContent = checked + ' of ' + total + ' items packed (' + pct + '%)';
  if (fill) fill.style.width = pct + '%';
}
updatePackProgress();

// â”€â”€ Gear List Manager â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function () {
  const GEAR_COLLECTION = 'gear_categories';

  let _gearData = [];
  let _editMode = false;
  let _isAdmin  = false;
  let _fsLoaded = false;
  let _origData = null; // snapshot for cancel

  // â”€â”€ Default / seed data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const GEAR_DEFAULT = [
    { id: 'bikes-bags', icon: 'ğŸš²', name: 'Bikes & Bags', order: 0, items: [
      { id: 'bb1', name: 'Touring bike (each)',   weight: '10.5 kg', who: 'Both', notes: 'Steel frame, 700c wheels' },
      { id: 'bb2', name: 'Rear panniers (pair)',  weight: '1.4 kg',  who: 'Both', notes: 'Ortlieb Back-Roller Classic' },
      { id: 'bb3', name: 'Front panniers (pair)', weight: '1.1 kg',  who: 'Both', notes: 'Ortlieb Front-Roller' },
      { id: 'bb4', name: 'Handlebar bag',         weight: '0.4 kg',  who: 'Both', notes: 'Quick access for snacks & map' },
      { id: 'bb5', name: 'Frame bag',             weight: '0.2 kg',  who: 'Both', notes: 'Tools & spares' },
    ]},
    { id: 'shelter-sleep', icon: 'â›º', name: 'Shelter & Sleep', order: 1, items: [
      { id: 'ss1', name: 'Tent (2-person)',       weight: '1.6 kg',  who: 'Tom',  notes: 'MSR Hubba Hubba NX' },
      { id: 'ss2', name: 'Sleeping bag (each)',   weight: '0.9 kg',  who: 'Both', notes: 'Down, comfort to 5Â°C' },
      { id: 'ss3', name: 'Sleeping mat (each)',   weight: '0.5 kg',  who: 'Both', notes: 'Thermarest NeoAir' },
      { id: 'ss4', name: 'Camping pillow (each)', weight: '0.1 kg',  who: 'Both', notes: 'Inflatable' },
    ]},
    { id: 'nav-tech', icon: 'ğŸ“¡', name: 'Navigation & Tech', order: 2, items: [
      { id: 'nt1', name: 'GPS device',           weight: '0.1 kg',  who: 'Both', notes: 'Garmin Edge 530' },
      { id: 'nt2', name: 'Smartphone (each)',    weight: '0.2 kg',  who: 'Both', notes: 'Offline maps downloaded' },
      { id: 'nt3', name: 'Solar charging panel', weight: '0.3 kg',  who: 'Tom',  notes: 'BigBlue 28W' },
      { id: 'nt4', name: 'Power bank (each)',    weight: '0.2 kg',  who: 'Both', notes: '20,000 mAh' },
      { id: 'nt5', name: 'Camera + lenses',      weight: '1.2 kg',  who: 'Mika', notes: 'Sony A6400 + 16-50 kit' },
      { id: 'nt6', name: 'Laptop (shared)',      weight: '1.3 kg',  who: 'Mika', notes: 'For blog & work on the road' },
    ]},
    { id: 'bike-maintenance', icon: 'ğŸ”§', name: 'Bike Maintenance', order: 3, items: [
      { id: 'bm1', name: 'Repair kit & multi-tool', weight: '0.4 kg', who: 'Both', notes: 'Leatherman + Park Tool' },
      { id: 'bm2', name: 'Spare tubes (Ã—4)',         weight: '0.4 kg', who: 'Both', notes: '700Ã—35c' },
      { id: 'bm3', name: 'Tyre levers + patches',    weight: '0.1 kg', who: 'Both', notes: 'â€”' },
      { id: 'bm4', name: 'Mini pump',                weight: '0.2 kg', who: 'Both', notes: 'Topeak Road Morph G' },
      { id: 'bm5', name: 'Chain lube & cleaner',     weight: '0.2 kg', who: 'Both', notes: 'â€”' },
    ]},
    { id: 'clothing', icon: 'ğŸ‘•', name: 'Clothing (per person)', order: 4, items: [
      { id: 'cl1', name: 'Cycling jerseys (Ã—3)',      weight: '0.4 kg', who: 'Both', notes: 'Merino wool preferred' },
      { id: 'cl2', name: 'Bib shorts (Ã—2)',           weight: '0.3 kg', who: 'Both', notes: 'Padded' },
      { id: 'cl3', name: 'Rain jacket',               weight: '0.4 kg', who: 'Both', notes: 'Lightweight packable' },
      { id: 'cl4', name: 'Thermal base layers',       weight: '0.3 kg', who: 'Both', notes: 'For cold mornings' },
      { id: 'cl5', name: 'Casual clothes (Ã—2 sets)',  weight: '0.8 kg', who: 'Both', notes: 'Off-bike wear' },
      { id: 'cl6', name: 'Cycling shoes (each)',      weight: '0.6 kg', who: 'Both', notes: 'SPD compatible' },
      { id: 'cl7', name: 'Sandals/flip-flops',        weight: '0.3 kg', who: 'Both', notes: 'Camp & casual' },
    ]},
    { id: 'safety-health', icon: 'ğŸ©º', name: 'Safety & Health', order: 5, items: [
      { id: 'sh1', name: 'Helmets (each)',              weight: '0.3 kg', who: 'Both', notes: 'MIPS rated' },
      { id: 'sh2', name: 'Lights front + rear (each)', weight: '0.2 kg', who: 'Both', notes: 'Rechargeable' },
      { id: 'sh3', name: 'High-vis vest',               weight: '0.1 kg', who: 'Both', notes: 'Some countries require by law' },
      { id: 'sh4', name: 'First aid kit',               weight: '0.4 kg', who: 'Mika', notes: 'Compact travel kit' },
      { id: 'sh5', name: 'Sun cream + lip balm',        weight: '0.2 kg', who: 'Both', notes: 'SPF 50+' },
      { id: 'sh6', name: 'Travel insurance docs',       weight: 'â€”',       who: 'Both', notes: 'Covering bike touring' },
    ]},
  ];

  function uid() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
  }
  function deepClone(obj) { return JSON.parse(JSON.stringify(obj)); }

  // â”€â”€ Firestore helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function ensureFirestore() {
    if (_fsLoaded) return;
    await window.TomikaBikes.ensureFirebaseAuth();
    await new Promise((resolve, reject) => {
      const ver = '10.12.2';
      const src = 'https://www.gstatic.com/firebasejs/' + ver + '/firebase-firestore-compat.js';
      if ([...document.scripts].some(s => s.getAttribute('src') === src)) { resolve(); return; }
      const s = document.createElement('script');
      s.src = src; s.onload = resolve; s.onerror = reject;
      document.head.appendChild(s);
    });
    _fsLoaded = true;
  }

  async function fetchFromFirestore() {
    const snap = await firebase.firestore().collection(GEAR_COLLECTION).orderBy('order').get();
    if (snap.empty) return null;
    return snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  }

  async function saveToFirestore(data) {
    const db    = firebase.firestore();
    const batch = db.batch();
    const existing = await db.collection(GEAR_COLLECTION).get();
    existing.docs.forEach(doc => batch.delete(doc.ref));
    data.forEach((cat, idx) => {
      batch.set(db.collection(GEAR_COLLECTION).doc(cat.id),
        { icon: cat.icon, name: cat.name, order: idx, items: cat.items });
    });
    await batch.commit();
  }

  // â”€â”€ Rendering â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function whoTag(who, editable) {
    if (editable) {
      return '<select class="gear-status-select" data-field="who">' +
        ['Both', 'Mika', 'Tom'].map(v =>
          '<option value="' + v + '"' + (who === v ? ' selected' : '') + '>' + v + '</option>'
        ).join('') + '</select>';
    }
    const cls = (who || 'both').toLowerCase();
    return '<span class="gear-tag ' + cls + '">' + (who || 'Both') + '</span>';
  }

  function parseWeight(w) {
    const m = (w || '').match(/([\d.]+)\s*kg/i);
    return m ? parseFloat(m[1]) : 0;
  }

  function updateWeightSummary(data) {
    let mika = 0, tom = 0;
    data.forEach(cat => {
      cat.items.forEach(item => {
        const w = parseWeight(item.weight);
        const who = (item.who || 'Both').toLowerCase();
        if (who === 'mika' || who === 'both') mika += w;
        if (who === 'tom'  || who === 'both') tom  += w;
      });
    });
    const elMika = document.getElementById('weightMika');
    const elTom  = document.getElementById('weightTom');
    if (elMika) elMika.textContent = mika.toFixed(1);
    if (elTom)  elTom.textContent  = tom.toFixed(1);
  }

  function renderGear(data, editMode) {
    const content = document.getElementById('gearContent');
    if (!content) return;
    let html = '';
    data.forEach(cat => {
      const cid = cat.id;
      html += '<div class="gear-category"' + (editMode ? ' data-editing="1"' : '') + ' data-cat-id="' + cid + '">';
      html += '<div class="gear-category-header">';
      html += '<span class="gear-category-icon"' + (editMode ? ' contenteditable="true" data-field="icon"' : '') + '>' + cat.icon + '</span>';
      html += '<h3' + (editMode ? ' contenteditable="true" data-field="name"' : '') + '>' + cat.name + '</h3>';
      if (editMode) html += '<button class="gear-cat-delete" onclick="GearManager.deleteCategory(\'' + cid + '\')" title="Remove category">âœ• Remove</button>';
      html += '</div>';
      html += '<table class="gear-table"><thead><tr><th>Item</th><th>Weight</th><th>Who</th><th>Notes</th>' + (editMode ? '<th></th>' : '') + '</tr></thead><tbody>';
      cat.items.forEach(item => {
        const iid = item.id;
        html += '<tr data-item-id="' + iid + '">';
        html += '<td' + (editMode ? ' contenteditable="true" data-field="name"' : '') + '>' + item.name + '</td>';
        html += '<td class="gear-weight"' + (editMode ? ' contenteditable="true" data-field="weight"' : '') + '>' + item.weight + '</td>';
        html += '<td>' + whoTag(item.who || 'Both', editMode) + '</td>';
        html += '<td class="gear-notes"' + (editMode ? ' contenteditable="true" data-field="notes"' : '') + '>' + item.notes + '</td>';
        if (editMode) html += '<td><button class="gear-row-delete" onclick="GearManager.deleteItem(\'' + cid + '\',\'' + iid + '\')" title="Delete row">ğŸ—‘</button></td>';
        html += '</tr>';
      });
      html += '</tbody>';
      if (editMode) {
        html += '<tfoot><tr><td colspan="5"><button class="gear-add-row-btn" onclick="GearManager.addItem(\'' + cid + '\')">ï¼‹ Add item</button></td></tr></tfoot>';
      }
      html += '</table></div>';
    });
    if (editMode) {
      html += '<button class="gear-add-cat-btn" onclick="GearManager.addCategory()">ï¼‹ Add category</button>';
    }
    content.innerHTML = html;
    updateWeightSummary(data);
  }

  function collectFromDOM() {
    const cats = [];
    document.querySelectorAll('#gearContent .gear-category').forEach(catEl => {
      const catId  = catEl.dataset.catId;
      const header = catEl.querySelector('.gear-category-header');
      const icon   = (header.querySelector('[data-field="icon"]') || {}).textContent || '';
      const name   = (header.querySelector('[data-field="name"]') || {}).textContent || '';
      const items  = [];
      catEl.querySelectorAll('tbody tr').forEach(row => {
        const nameEl   = row.querySelector('[data-field="name"]');
        const weightEl = row.querySelector('[data-field="weight"]');
        const whoEl    = row.querySelector('[data-field="who"]');
        const notesEl  = row.querySelector('[data-field="notes"]');
        if (!nameEl) return;
        items.push({
          id:     row.dataset.itemId || uid(),
          name:   nameEl.textContent.trim(),
          weight: weightEl ? weightEl.textContent.trim() : '',
          who:    whoEl    ? whoEl.value                 : 'Both',
          notes:  notesEl  ? notesEl.textContent.trim()  : '',
        });
      });
      cats.push({ id: catId, icon: icon.trim(), name: name.trim(), items });
    });
    return cats;
  }

  // â”€â”€ Public API (called by onclick in generated HTML) â”€â”€â”€â”€â”€â”€
  window.GearManager = {
    deleteCategory(catId) {
      _gearData = collectFromDOM();
      _gearData = _gearData.filter(c => c.id !== catId);
      renderGear(_gearData, true);
    },
    deleteItem(catId, itemId) {
      _gearData = collectFromDOM();
      const cat = _gearData.find(c => c.id === catId);
      if (cat) cat.items = cat.items.filter(i => i.id !== itemId);
      renderGear(_gearData, true);
    },
    addItem(catId) {
      _gearData = collectFromDOM();
      const cat = _gearData.find(c => c.id === catId);
      if (cat) cat.items.push({ id: uid(), name: 'New item', weight: '0.0 kg', who: 'Both', notes: '' });
      renderGear(_gearData, true);
    },
    addCategory() {
      _gearData = collectFromDOM();
      _gearData.push({ id: uid(), icon: 'ğŸ“¦', name: 'New Category', order: _gearData.length, items: [] });
      renderGear(_gearData, true);
    },
  };

  // â”€â”€ Edit mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setEditMode(on) {
    _editMode = on;
    document.getElementById('gearEditBtn').style.display   = on ? 'none' : '';
    document.getElementById('gearSaveBtn').style.display   = on ? '' : 'none';
    document.getElementById('gearCancelBtn').style.display = on ? '' : 'none';
    renderGear(_gearData, on);
  }

  document.getElementById('gearEditBtn').addEventListener('click', () => {
    _origData = deepClone(_gearData);
    setEditMode(true);
  });

  document.getElementById('gearSaveBtn').addEventListener('click', async () => {
    _gearData = collectFromDOM();
    const btn = document.getElementById('gearSaveBtn');
    btn.disabled = true;
    btn.textContent = 'Savingâ€¦';
    try {
      await ensureFirestore();
      await saveToFirestore(_gearData);
      _origData = null;
      setEditMode(false);
      window.TomikaBikes.showToast('Gear list saved!', 'success');
    } catch (e) {
      console.error('Gear save failed:', e);
      window.TomikaBikes.showToast('Save failed: ' + e.message, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'ğŸ’¾ Save';
    }
  });

  document.getElementById('gearCancelBtn').addEventListener('click', () => {
    if (_origData) { _gearData = _origData; _origData = null; }
    setEditMode(false);
  });

  // â”€â”€ Watch auth state to show/hide admin bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function watchAdminState() {
    if (typeof firebase === 'undefined' || !firebase.apps.length) {
      setTimeout(watchAdminState, 400);
      return;
    }
    firebase.auth().onAuthStateChanged(user => {
      const adminEmail = (typeof ADMIN_EMAIL !== 'undefined') ? ADMIN_EMAIL : null;
      _isAdmin = !!(user && adminEmail && user.email === adminEmail);
      document.getElementById('gearAdminBar').style.display = _isAdmin ? 'flex' : 'none';
      if (!_isAdmin && _editMode) setEditMode(false);
    });
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    try {
      await window.TomikaBikes.ensureFirebaseAuth();
      await ensureFirestore();
      const data = await fetchFromFirestore();
      _gearData = data || GEAR_DEFAULT;
      if (!data) await saveToFirestore(_gearData); // seed Firestore on first visit
    } catch (e) {
      console.warn('Firestore unavailable, using built-in gear data:', e);
      _gearData = GEAR_DEFAULT;
    }
    renderGear(_gearData, false);
    watchAdminState();
  }

  init();
})();
</script>
</body>
</html>
